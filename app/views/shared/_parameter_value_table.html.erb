<% form_tag(request_path,:method => "put") do %>

    <% if rules %>
        <script type="text/javascript">
        $(document).ready(function(){
          <% columns = cols - ["parameter"] %>
          $("#<%= pid %>_parameter").change(function () {
              <% columns.each do |c| %>
                $("#<%= pid %>_<%= c %>").removeAttr("disabled");
              <% end %>
              <% rules.each do |key,value| %>
                //<%= key %>
                <% if key[0,1]==">" %>
                  if ($("#<%= pid %>_parameter option:selected").text().substring(0,<%= key.size-1 %>)=="<%= key[1..-1] %>")
                <% elsif key[0,1]=="="  %>
                  if ($("#<%= pid %>_parameter option:selected").text()=="<%= key[1..-1] %>")
                <% end %>
              {
                <% value.each do |c| %>
                  $("#<%= pid %>_<%= c %>").attr("disabled", true);
                <% end %>
              }
              <% end %>
            })
            .change();
        });
        </script>
    <% end %>

	<table class="tableparameter">
		
		<thead><tr>
			<% cols.each do |c| %><th><%= c.humanize %></th><% end %><th></th>
		</tr></thead>

		<tbody>             
		
		<% object.parameter_values_for(parameters).each do |pv| %>
		<tr>
			<% cols.each do |c| %>
			    <% if c=="parameter" %>
			        <td><%= pv.parameter %></td>
			    <% elsif c=="commodity" %>
    			    <td><%= pv.commodity %></td>
    			<% elsif c=="technology" %>
        		    <td><%= pv.technology %></td>
        		<% elsif c=="in_flow" %>
            		<td><%= commodity_url_list(pv.in_flow) %></td>
                <% elsif c=="out_flow" %>
            		<td><%= commodity_url_list(pv.out_flow) %></td>
                <% elsif c=="flow" %>
            		<td><%= commodity_url_list(pv.flow) %></td>
    		    <% else %>
				    <td><span id="pv-<%= pv.id %>-<%= c %>" <%= 'class="edit"' if editable.include? c %> ><%=h pv.attributes[c] %></span></td>
				<% end %>
			<% end %>
		<td><input type="checkbox" name="cb<%= pv.id  %>" /></td>
		</tr>
		<% end %>
		
		<tr>
			<% cols.each do |c| %>
			    <% if c=="parameter" %>
			    <td><select id="<%= pid %>_<%= c %>" name="pv[<%= c %>]">
			        <% parameters.each do |p| %><option><%=h p %></option><% end -%>
                </select></td>
                <% elsif c=="in_flow" %>
                <td><select id="<%= pid %>_<%= c %>" name="pv[<%= c %>_id]"><% object.in_flows.each do |f| %>
        			<option value="<%=f.id%>"><%=f.id%>: <%= commodity_list(f) %></option><% end -%>
        		</select></td>
                <% elsif c=="out_flow" %>
                <td><select id="<%= pid %>_<%= c %>" name="pv[<%= c %>_id]"><% object.out_flows.each do |f| %>
        			<option value="<%=f.id%>"><%=f.id%>: <%= commodity_list(f) %></option><% end -%>
        		</select></td>
        		<% elsif c=="flow" %>
        		<td><select id="<%= pid %>_<%= c %>" name="pv[<%= c %>_id]">
                    <optgroup label="In flow">
                        <% object.in_flows.each do |f| %>
        					<option value="<%=f.id%>"><%=f.id%>: <%= commodity_list(f) %></option>
        				<% end -%>
                    </optgroup>
                    <optgroup label="Out flow">
                        <% object.out_flows.each do |f| %>
        					<option value="<%=f.id%>"><%=f.id%>: <%= commodity_list(f) %></option>
        				<% end -%>
                    </optgroup>
                </select></td>
			    <% else %>
				<td><input type="textcell" id="<%= pid %>_<%= c %>" name="pv[<%= c %>]"/></td>
				<% end %>
			<% end %>
		<td></td>
		</tr>
		
		</tbody>

	</table>
	
	<select name="do">
	    <option value="add_pv">Add parameter value</option>
	    <option value="delete_pv">Delete checked parameter value(s)</option>
	</select>
	
	<% if parameters.size==1 %>
		<input type="hidden" id="<%= pid %>_parameter" name="pv[parameter]" value="<%= parameters[0] %>" />
	<% end %>
	<%= submit_tag 'OK' %>
<% end %>
