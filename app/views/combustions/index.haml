:javascript
  function add_combustion() {
    $('#form_ #do').attr('value','add_pv');
    $('#form_').submit();
  }
  function delete_combustions() {
    if (confirm("Are you sure?")) {
      $('#form_ #do').attr('value','delete_pv');
      $('#form_').submit();
    };
  }
  function draw_editable() {
    $('.edit').editable(#{raw update_value_combustions_path.to_json},{
        style   : 'inherit',
        width   : "100%",
        height  : 15,
        method  : "PUT",
        id      : 'field',
        submitdata: {
          authenticity_token: #{raw form_authenticity_token.to_json}
        }
    });
  }
  $(document).ready(function() {
  	$('.list_table').dataTable( {
  		"bProcessing"    : true,
  		"bServerSide"    : true,
  	    "bFilter"        : true,
        "bLengthChange"  : true,
        "bStateSave"     : true,
        "bSort"          : true,
        "bInfo"          : true,
        "aaSorting"      : [[1,'asc']],
        "sPaginationType": "full_numbers",
        "iDisplayLength" : 25,
        "bAutoWidth"     : false,
  		"sAjaxSource"    : #{list_combustions_path.to_json},
  	    "fnServerData"   : function ( sSource, aoData, fnCallback ) {
            aoData.push( { "name": "set", "value": #{params[:set].to_json} } );
            $.getJSON( sSource, aoData, function (json) {
              fnCallback(json)
            } );
          },
        "fnDrawCallback": function() { draw_editable(); },
        "aoColumnDefs"   : [ {"bSortable" : false, "aTargets": [0,-1] }],
  	    "oLanguage"      : {"sSearch": "Filter:","sProcessing": #{image_tag("spinner.gif").to_json}},
  	    "sDom"           : 'lrftpi'
  	} );
    $('.check_all').click(function () {
      $(this).parents('table:eq(0)').find(':checkbox').attr('checked', this.checked);
    } );
  } );

.grid_12
  .box
    %h2 Combustion coefficients
    %p
      = form_tag(combustions_path,:method => "post",:id=>"form_") do
        %input(type="hidden" id="do" name="do" value="")
        %table(class="list_table" summary="Commodity list")
          %thead
            %th(class='check')
              = check_box_tag("click_check",nil,nil,:class=>"check_all")
            %th(class='name') Fuel
            %th(class='name') Pollutant
            %th(class='value') Value
            %th Source
            %th(class="check")
          %tbody
            %tr
              %td(colspan="6" class="list_table_empty")
                Loading data
          %tfoot
            %tr
              %th(class="check")
                = link_to_function "Delete", "delete_combustions()", :class => "action delete_values", :confirm => "Are you sure?"
              %th
                %select(id="combustion_fuel" name="combustion[fuel_id]")
                  = options_for_select(Commodity.energy_carriers.order(:name).collect {|c| [ c.name, c.id ] })
              %th
                %select(id="combustion_pollutant" name="combustion[pollutant_id]")
                  = options_for_select(Commodity.pollutants.order(:name).collect {|c| [ c.name, c.id ] })
              %th
                %input(type="textcell" id="combustion_value" name="combustion[value]")
              %th
                %input(type="textcell" id="combustion_source" name="combustion[source]")
              %th(class="check")
                = link_to_function "Add", "add_combustion()", :class => "action add_value"

    %br
    %br
