<% content_for :title, "Editing commodity" %>

<script type="text/javascript">
$(document).ready(function() {
    $('.edit').editable(<%= commodity_path(@commodity).to_json %>,{
        style   : 'inherit',
        width   : 150,
        height  : 18,
        method  : "PUT",
        id      : 'field',
        indicator : <%= image_tag("spinner.gif").to_json %>,
        submitdata: {
          authenticity_token: <%= form_authenticity_token.to_json %>
        }
    });
});
</script>

<div class="grid_3">

  <div class="box">
    <h2>ID card</h2>
    <div class="block">
    <% form_for(@commodity) do |f| %>
      <%= f.error_messages %>
      <fieldset class="idcard" >
          <p><%= f.label :name, 'Name:' %> <%= f.text_field :name %></p>
          <p><%= f.label :description, 'Description:' %>
             <%= f.text_area :description, :rows => 2 %></p>
          <p><%= f.label :sets, 'Sets:' %> <%=h @commodity.set_list.join(", ") %></p>
          <input type="hidden" name="do" value="update" />
          <p><%= f.submit 'Update', :class => "button" %></p>
       </fieldset>
      <% end %>
    </div>
  </div>

  <div class="box">
    <h2>Connections</h2>
    <div class="block">
         <p>
          <% if @commodity.consumed_by.size > 0 %>
            Consumed by <%= pluralize(@commodity.consumed_by.size, 'technology') %>:
            <%= select_tag "consumed_by", options_for_select(["Select..."] + @commodity.consumed_by.map{|c|[c.name,c.id]}),
                {:onchange => "if(this.value.length>0){location.href='/technologies/'+this.value+'/edit';}"} %>.
          <% else %>
            Not consumed.
          <% end %><br />
          <% if @commodity.produced_by.size > 0 %>
            Produced by <%= pluralize(@commodity.produced_by.size, 'technology') %>:
            <%= select_tag "produced_by", options_for_select(["Select..."] + @commodity.produced_by.map{|c|[c.name,c.id]}),
                {:onchange => "if(this.value.length>0){location.href='/technologies/'+this.value+'/edit';}"} %>.
          <% else %>
            Not produced.
          <% end %>
         </p>
    </div>
  </div>

</div>

<% if @commodity.demand? %>

  <div class="grid_9">
    <div class="box">
      <h2>Parameters</h2>
      <div class="block">

        <%= render :partial => 'shared/parameter_table',
            :locals => {:object => @commodity,
            :pid => "param",
            :request_path => edit_commodity_path(@commodity),
            :parameters => %w{demand frac_dem},
            :cols => %w{parameter time_slice year value source},
            :editable => %w{value source},
            :rules => {"=demand" => %w{time_slice},
                       "=frac_dem" => %w{year} } } %>

      </div>
    </div>
  </div>

<% else %>

  <div class="grid_9">
    <div class="box">
      <h2>Parameters</h2>
      <div class="block">

<%= render :partial => 'shared/parameter_table',
            :locals => {:object => @commodity,
            :pid => "param",
            :request_path => edit_commodity_path(@commodity),
            :parameters => %w{network_efficiency peak_reserve cost_imp cost_exp imp_bnd_lo imp_bnd_fx imp_bnd_up exp_bnd_lo exp_bnd_fx exp_bnd_up},
            :cols => %w{parameter time_slice year value source},
            :editable => %w{value source},
            :rules => {"=network_efficiency" => %w{time_slice year},
                       "=com_net_bnd_up_t"  => %w{time_slice}} } %>

      </div>
    </div>

  </div>

<% end %>