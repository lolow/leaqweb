:javascript
  $(function(){
    $(".multiselect").multiselect({sortable: false, searchable: true});
  });
  function add_parameter_value(pid) {
    $('#form_' + pid + ' #do').attr('value','add_pv');
    $('#form_' + pid).submit();
  }
  function delete_parameter_values(pid) {
    if (confirm("Are you sure?")) {
      $('#form_' + pid + ' #do').attr('value','delete_pv');
      $('#form_' + pid).submit();
    };
  }
  $(document).ready(function() {
    $('.check_all').click(function () {
      $(this).parents('table:eq(0)').find(':checkbox').attr('checked', this.checked);
    });
  } );

.grid_3

  .box(class="action")
    %h2 Actions
    %br
    %p= link_to 'Browse', aggregates_path, :class => "action browse"
    %p
      = link_to 'New', new_aggregate_path, :class => "action new"
      = link_to 'Delete', @aggregate, :confirm => 'Are you sure?', :method => :delete, :class => "action delete"

  .box
    %h2 Aggregate
    .block(id="idcard")
      = simple_form_for @aggregate do |f|
        =f.input :name, :required => true, :input_html => { :size => nil }
        =f.input :description, :as => :text, :input_html => {:rows => 2, :cols=>nil}
        =f.input :set_list, :as => :hidden, :input_html => {:value => "AGG"}
        =f.button :submit
        %input(type="hidden" name="do" value="update")

.grid_9
  .box
    %h2 Commodities
    .block
      =simple_form_for @aggregate do |f|
        =f.association :commodities, :collection => Commodity.all(:order => 'name'),
                       :input_html => {:class=>"multiselect", :multiple=>"multiple"}
        =f.button :submit, :class => "aligned"
        %input(type="hidden" name="do" value="update")

  .box
    %h2 Parameters
    .block
      :erb
        <%= render :partial => 'shared/parameter_table',
                  :locals => { :object => @aggregate,
                               :pid => "param",
                               :length_change => "false",
                               :filter => "false",
                               :request_path => aggregate_path(@aggregate),
                               :parameters => %w{agg_coef aggregate_annual_up degree_of_use},
                               :cols => %w{parameter commodity year value source},
                               :editable => %w{value source},
                               :rules => {"=agg_coef" => %w{year}, "=aggregate_annual_up" => %w{commodity} } }%>
.clear